--== ğŸ—ï¸ æœåŠ¡ ==--
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--== ğŸ›¡ï¸ ç™½åå•éªŒè¯ ==--
local allowedNames = {
    "YXZM1017",
    "CN_PT6",
    "PT7776",
}
local function isAllowed(name)
    for _, v in ipairs(allowedNames) do
        if v == name then return true end
    end
    return false
end
if not isAllowed(LocalPlayer.Name) then
    StarterGui:SetCore("SendNotification", {
        Title = "æƒé™æ‹’ç»";
        Text = "æ£€æµ‹åˆ°æœªæˆæƒç”¨æˆ·ï¼Œè¯·è´­ä¹°æ­£ç‰ˆä½¿ç”¨ï¼";
        Duration = 5;
    })
    task.delay(1, function()
        LocalPlayer:Kick("æ£€æµ‹åˆ°æœªæˆæƒç”¨æˆ·ï¼Œè¯·è´­ä¹°æ­£ç‰ˆä½¿ç”¨ï¼")
    end)
    return
end

_G.AIMLOCK_ENABLED = false
_G.HEATVISION_ENABLED = false
_G.SHOW_NAMES = true
_G.SHOW_DISTANCE = true
_G.FOV_RADIUS = 100
_G.TEAM_CHECK = true
_G.LOCK_KEY = Enum.UserInputType.MouseButton2

_G.FLY_ENABLED = false
_G.SPEED_ENABLED = false
_G.NOCOLLIDE_ENABLED = false

local aimParts = {"Head", "Neck", "LeftHand", "RightHand", "LeftFoot", "RightFoot", "HumanoidRootPart"}
local aimPartIndex = 1
_G.AIM_PART = aimParts[aimPartIndex]
local currentTarget = nil

--== æ­»äº¡åˆ¤æ–­ ==--
local function isDead(character)
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return true end
    return false
end

--==  UI åˆ›å»º ==--
local screenGui = Instance.new("ScreenGui", CoreGui)
screenGui.Name = "AimUI"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.Size = UDim2.new(0, 280, 0, 500)
mainFrame.Position = UDim2.new(0, 20, 0.5, -250)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)
mainFrame.Active = true
mainFrame.Draggable = false -- è‡ªå®šä¹‰æ‹–åŠ¨

local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Text = "ç©å®¶å†›å›¢4.0"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 20

-- æ‹–åŠ¨åŠŸèƒ½
local dragging = false
local dragInput
local dragStart
local startPos

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- æŒ‰é’®åˆ›å»ºå·¥å…·
local yOffset = 45
local function createToggle(name, default, callback)
    local toggle = Instance.new("TextButton", mainFrame)
    toggle.Size = UDim2.new(1, -20, 0, 30)
    toggle.Position = UDim2.new(0, 10, 0, yOffset)
    toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    toggle.Text = name .. ": " .. (default and "ON" or "OFF")
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.Font = Enum.Font.Gotham
    toggle.TextSize = 16
    yOffset = yOffset + 35

    local state = default
    toggle.MouseButton1Click:Connect(function()
        state = not state
        toggle.Text = name .. ": " .. (state and "ON" or "OFF")
        callback(state)
    end)
end

--== ğŸŒˆ é˜µè¥æ™ºèƒ½çƒ­æˆåƒç³»ç»Ÿï¼ˆä¿®æ”¹ç‰ˆï¼‰ ==--
local colorPalette = {
    Color3.fromRGB(255, 0, 0),     -- çº¢
    Color3.fromRGB(0, 120, 255),   -- è“
    Color3.fromRGB(255, 255, 0),   -- é»„
    Color3.fromRGB(255, 0, 255),   -- ç´«
    Color3.fromRGB(255, 165, 0),   -- æ©™
}

local teamColorMap = {}

local function assignTeamColors()
    teamColorMap = {}
    local uniqueTeams = {}
    for _, p in ipairs(Players:GetPlayers()) do
        local teamKey = p.Team and p.Team.Name or (p.TeamColor and tostring(p.TeamColor)) or "NoTeam"
        if not table.find(uniqueTeams, teamKey) then
            table.insert(uniqueTeams, teamKey)
        end
    end
    for i, teamKey in ipairs(uniqueTeams) do
        teamColorMap[teamKey] = colorPalette[(i - 1) % #colorPalette + 1]
    end
end

-- åªä¿®æ”¹é¢œè‰²é€»è¾‘ï¼šå·±æ–¹å›ºå®šç»¿è‰²ï¼Œæ•Œæ–¹æŒ‰åŸé€»è¾‘
local function applyHighlight(player)
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    if isDead(player.Character) then return end

    local color
    if player == LocalPlayer or player.Team == LocalPlayer.Team then
        -- å·±æ–¹å›ºå®šç»¿è‰²
        color = Color3.fromRGB(0, 255, 0)
    else
        -- å…¶ä»–é˜µè¥é¢œè‰²æŒ‰åŸé€»è¾‘
        local teamKey = player.Team and player.Team.Name or (player.TeamColor and tostring(player.TeamColor)) or "NoTeam"
        color = teamColorMap[teamKey] or Color3.fromRGB(255, 0, 0) -- é»˜è®¤çº¢è‰²
    end

    if not player.Character:FindFirstChild("HeatVision") then
        local hl = Instance.new("Highlight")
        hl.Name = "HeatVision"
        hl.FillColor = color
        hl.OutlineColor = Color3.new(
            math.clamp(color.R + 0.3, 0, 1),
            math.clamp(color.G + 0.3, 0, 1),
            math.clamp(color.B + 0.3, 0, 1)
        )
        hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        hl.Adornee = player.Character
        hl.Parent = player.Character
    else
        player.Character.HeatVision.FillColor = color
        player.Character.HeatVision.OutlineColor = Color3.new(
            math.clamp(color.R + 0.3, 0, 1),
            math.clamp(color.G + 0.3, 0, 1),
            math.clamp(color.B + 0.3, 0, 1)
        )
    end
end

-- ç©å®¶åŠ å…¥æ—¶åŠ¨æ€é‡æ–°åˆ†é…é¢œè‰²
Players.PlayerAdded:Connect(function(p)
    p:GetPropertyChangedSignal("Team"):Connect(assignTeamColors)
end)

-- ç©å®¶å + è·ç¦»æ˜¾ç¤º (å­—ä½“å¤§å°è°ƒæ•´)
local function updateNames(state)
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            if state then
                if not head:FindFirstChild("NameBillboard") then
                    local bb = Instance.new("BillboardGui", head)
                    bb.Name = "NameBillboard"
                    bb.Size = UDim2.new(0, 200, 0, 20) -- é«˜åº¦ç¼©å°ï¼Œé¿å…å¤ªå¤§
                    bb.StudsOffset = Vector3.new(0, 2, 0)
                    bb.AlwaysOnTop = true

                    local nameLabel = Instance.new("TextLabel", bb)
                    nameLabel.Size = UDim2.new(1, 0, 0, 7)  -- ç¼©å°ä¸€åŠ
                    nameLabel.Position = UDim2.new(0, 0, 0, 0)
                    nameLabel.BackgroundTransparency = 1
                    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                    nameLabel.Text = player.Name
                    nameLabel.TextScaled = false
                    nameLabel.Font = Enum.Font.Gotham
                    nameLabel.TextSize = 10

                    local distLabel = Instance.new("TextLabel", bb)
                    distLabel.Name = "DistanceLabel"
                    distLabel.Size = UDim2.new(1, 0, 0, 5)  -- ç¼©å°åˆ°ä¸‰åˆ†ä¹‹ä¸€
                    distLabel.Position = UDim2.new(0, 0, 0, 7)
                    distLabel.BackgroundTransparency = 1
                    distLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                    distLabel.Text = "..."
                    distLabel.TextScaled = false
                    distLabel.Font = Enum.Font.Gotham
                    distLabel.TextSize = 7
                end
            else
                local bb = head:FindFirstChild("NameBillboard")
                if bb then bb:Destroy() end
            end
        end
    end
end

--== ğŸ”˜ UI æ§åˆ¶æŒ‰é’® ==
createToggle("å¯ç”¨è‡ªç„", _G.AIMLOCK_ENABLED, function(val) _G.AIMLOCK_ENABLED = val end)
createToggle("å¼€å¯çƒ­æˆåƒ", _G.HEATVISION_ENABLED, function(val)
    _G.HEATVISION_ENABLED = val
    updateHeatVision(val)
end)
createToggle("æ˜¾ç¤ºç©å®¶å", _G.SHOW_NAMES, function(val)
    _G.SHOW_NAMES = val
    updateNames(val)
end)
createToggle("æ˜¾ç¤ºè·ç¦»", _G.SHOW_DISTANCE, function(val) _G.SHOW_DISTANCE = val end)
createToggle("é˜Ÿä¼æ£€æµ‹", _G.TEAM_CHECK, function(val)
    _G.TEAM_CHECK = val
    updateHeatVision(_G.HEATVISION_ENABLED)
end)

-- é€Ÿåº¦æå‡
createToggle("é€Ÿåº¦æå‡", _G.SPEED_ENABLED, function(val)
    _G.SPEED_ENABLED = val
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        LocalPlayer.Character:FindFirstChildOfClass("Humanoid").WalkSpeed = val and 50 or 16
    end
end)

-- ç©¿å¢™æ¨¡å¼
createToggle("ç©¿å¢™æ¨¡å¼", _G.NOCOLLIDE_ENABLED, function(val)
    _G.NOCOLLIDE_ENABLED = val
end)

-- é”å®šéƒ¨ä½åˆ‡æ¢æŒ‰é’®
local partBtn = Instance.new("TextButton", mainFrame)
partBtn.Size = UDim2.new(1, -20, 0, 30)
partBtn.Position = UDim2.new(0, 10, 0, yOffset)
partBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
partBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
partBtn.Font = Enum.Font.Gotham
partBtn.TextSize = 16
partBtn.Text = "é”å®šéƒ¨ä½: " .. _G.AIM_PART
yOffset = yOffset + 35
partBtn.MouseButton1Click:Connect(function()
    aimPartIndex = aimPartIndex % #aimParts + 1
    _G.AIM_PART = aimParts[aimPartIndex]
    partBtn.Text = "é”å®šéƒ¨ä½: " .. _G.AIM_PART
end)

--== ğŸ›ï¸ FOV æ˜¾ç¤ºæ ‡ç­¾å’Œæ»‘åŠ¨æ¡ ==--
local fovLabel = Instance.new("TextLabel", mainFrame)
fovLabel.Size = UDim2.new(1, -20, 0, 20)
fovLabel.Position = UDim2.new(0, 10, 0, yOffset)
fovLabel.BackgroundTransparency = 1
fovLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fovLabel.Font = Enum.Font.Gotham
fovLabel.TextSize = 14
fovLabel.Text = "è‡ªç„FOVåŠå¾„: " .. _G.FOV_RADIUS
yOffset = yOffset + 22

local fovSlider = Instance.new("Frame", mainFrame)
fovSlider.Size = UDim2.new(1, -20, 0, 20)
fovSlider.Position = UDim2.new(0, 10, 0, yOffset)
fovSlider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
fovSlider.BorderSizePixel = 0
yOffset = yOffset + 30

local fill = Instance.new("Frame", fovSlider)
fill.Size = UDim2.new(_G.FOV_RADIUS / 300, 0, 1, 0)
fill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)

local draggingFOV = false

fovSlider.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingFOV = true
    end
end)

fovSlider.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingFOV = false
    end
end)

fovSlider.InputChanged:Connect(function(input)
    if draggingFOV and input.UserInputType == Enum.UserInputType.MouseMovement then
        local mouseX = input.Position.X
        local sliderPos = fovSlider.AbsolutePosition.X
        local sliderSize = fovSlider.AbsoluteSize.X
        local relative = math.clamp(mouseX - sliderPos, 0, sliderSize)
        local ratio = relative / sliderSize
        _G.FOV_RADIUS = math.floor(ratio * 300)
        if _G.FOV_RADIUS < 10 then _G.FOV_RADIUS = 10 end
        fill.Size = UDim2.new(ratio, 0, 1, 0)
        fovLabel.Text = "è‡ªç„FOVåŠå¾„: " .. _G.FOV_RADIUS
    end
end)

--== ğŸª„ UI éšè—å¿«æ·é”® ==--
local tip = Instance.new("TextLabel", mainFrame)
tip.Size = UDim2.new(1, -20, 0, 20)
tip.Position = UDim2.new(0, 10, 1, -25)
tip.BackgroundTransparency = 1
tip.TextColor3 = Color3.fromRGB(150, 150, 150)
tip.Font = Enum.Font.Gotham
tip.TextSize = 14
tip.Text = "æŒ‰ RightShift éšè—/æ˜¾ç¤º UI"

UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.RightShift then
        mainFrame.Visible = not mainFrame.Visible
    end
end)

--== ğŸ”’ è‡ªç„é€»è¾‘ ==--
RunService.RenderStepped:Connect(function()
    if _G.FLY_ENABLED and LocalPlayer.Character then
        local flyVel = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if flyVel then
            local moveVec = Vector3.zero
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveVec += Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveVec -= Camera.CFrame.LookVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveVec -= Camera.CFrame.RightVector end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveVec += Camera.CFrame.RightVector end
            flyVel.Velocity = moveVec * 80
        end
    end

    if _G.NOCOLLIDE_ENABLED and LocalPlayer.Character then
        for _, v in pairs(LocalPlayer.Character:GetDescendants()) do
            if v:IsA("BasePart") then
                v.CanCollide = false
            end
        end
    end

    if _G.AIMLOCK_ENABLED and UserInputService:IsMouseButtonPressed(_G.LOCK_KEY) then
        if currentTarget and currentTarget:IsDescendantOf(workspace) then
            local targetCharacter = currentTarget.Parent
            if targetCharacter and not isDead(targetCharacter) then
                local targetPlayer = Players:GetPlayerFromCharacter(targetCharacter)
                if not (_G.TEAM_CHECK and targetPlayer and targetPlayer.Team == LocalPlayer.Team) then
                    Camera.CFrame = CFrame.new(Camera.CFrame.Position, currentTarget.Position)
                    return
                end
            end
        end
        local shortest = math.huge
        local bestTarget = nil
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild(_G.AIM_PART) then
                if _G.TEAM_CHECK and player.Team == LocalPlayer.Team then continue end
                if isDead(player.Character) then continue end
                local part = player.Character[_G.AIM_PART]
                local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
                local dist = (Vector2.new(screenPos.X, screenPos.Y) - UserInputService:GetMouseLocation()).Magnitude
                if onScreen and dist < _G.FOV_RADIUS and dist < shortest then
                    shortest = dist
                    bestTarget = part
                end
            end
        end
        currentTarget = bestTarget
    else
        currentTarget = nil
    end
end)

--== ğŸ“ è·ç¦»æ˜¾ç¤º ==--
RunService.RenderStepped:Connect(function()
    if not _G.SHOW_NAMES then return end
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local bb = player.Character.Head:FindFirstChild("NameBillboard")
            if bb then
                local distLabel = bb:FindFirstChild("DistanceLabel")
                if distLabel then
                    if _G.SHOW_DISTANCE then
                        local hrp = player.Character:FindFirstChild("HumanoidRootPart")
                        if hrp and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                            local dist = (LocalPlayer.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
                            distLabel.Text = string.format("[%.1f m]", dist)
                            distLabel.Visible = true
                        else
                            distLabel.Visible = false
                        end
                    else
                        distLabel.Visible = false
                    end
                end
            end
        end
    end
end)

--== ç©å®¶åŠ å…¥è‡ªåŠ¨å¤„ç† ==--
Players.PlayerAdded:Connect(function(p)
    p.CharacterAdded:Connect(function()
        task.wait(1)
        if _G.HEATVISION_ENABLED then applyHighlight(p) end
        if _G.SHOW_NAMES then updateNames(true) end
    end)
end)

-- åˆå§‹ä¸ºæ‰€æœ‰ç©å®¶åº”ç”¨é«˜äº®å’Œåå­—æ˜¾ç¤ºï¼ˆå¦‚æœå¼€å¯ï¼‰
task.spawn(function()
    while true do
        if _G.HEATVISION_ENABLED then
            for _, p in ipairs(Players:GetPlayers()) do
                if p ~= LocalPlayer then applyHighlight(p) end
            end
        end
        task.wait(10)
    end
end)

-- Wé”®æ‰‹åŠ¨åˆ·æ–°çƒ­æˆåƒï¼ˆæµ‹è¯•ç”¨ï¼‰
UserInputService.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.W and _G.HEATVISION_ENABLED then
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer then applyHighlight(p) end
        end
        print("â™¨ï¸ çƒ­æˆåƒæ‰‹åŠ¨åˆ·æ–°å®Œæˆ")
    end
end)

--== ç½²å ==
local signature = Instance.new("TextLabel", mainFrame)
signature.Size = UDim2.new(1, -20, 0, 20)
signature.Position = UDim2.new(0, 10, 1, -50)
signature.BackgroundTransparency = 1
signature.TextColor3 = Color3.fromRGB(0, 255, 0)
signature.Font = Enum.Font.GothamBold
signature.TextSize = 14
signature.Text = "æœ¬è„šæœ¬ç”±Jeeï¼ˆgithub:YXZM1017)å¼€å‘ æ›´æ–°æ—¶é—´2025.10.22"
signature.TextXAlignment = Enum.TextXAlignment.Center

print("âœ… è„šæœ¬åŠ è½½å®Œæˆï¼ˆç™½åå•+çƒ­æˆåƒ+é€Ÿåº¦+ç©¿å¢™+UI+è‡ªç„+è·ç¦»æ˜¾ç¤º+å¯æ‹–åŠ¨+FOVè°ƒèŠ‚ï¼‰")
